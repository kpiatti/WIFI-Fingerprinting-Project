---
title: "WIFI Fingerprinting Project"
author: "Katherine Piatti"
date: "4/13/2021"
output: html_document
---

# PROJECT SUMMARY ############################################

The client needs a system to help people navigate complex, unfamiliar interior spaces without getting lost (e.g.industrial campuses, shopping malls, etc.). They would like us to investigate the feasibility of using "wifi fingerprinting". 

>
>
Wifi fingerprinting uses the signals from multiple wifi hotspots within the buildinga to determine location, analogously to how GPS uses satellite signals.

Why not use GPS? While GPS works fairly reliably outdoors, it generally doesn't work indoors.

We have been provided with a large database of wifi fingerprints from a multi-building industrial campus, each fingerprint is associated with a building, floor, and location ID.

Your job is to evaluate multiple machine learning models to see which produces the best result, enabling us to make a recommendation to the client. 



# Dataset ##############################################################

From UCI Machine Learning Repository ([here](http://archive.ics.uci.edu/ml/datasets/UJIIndoorLoc)).

> Automatic user localization consists of estimating the position of the user (latitude, longitude and altitude) by using an electronic device, usually a mobile phone. Outdoor localization problem can be solved very accurately thanks to the inclusion of GPS sensors into the mobile devices. However, indoor localization is still an open problem mainly due to the loss of GPS signal in indoor environments. Although, there are some indoor positioning technologies and methodologies, this database is focused on WLAN fingerprint-based ones (also know as WiFi Fingerprinting).

### Characteristics

- covers 3 buildings with 4 or more floors and almost 110.000m2
- appropriate for classification (e.g. building & floor identification) or regression (e.g. longitude & latitude estimation). 
- created in 2013 by more than 20 users and 25 Android devices. 
- contains 19,937 training/reference records & 1,111 validation/test records and 529 attributes.
- each WiFi fingerprint can be characterized by the *detected Wireless Access Points* (WAPs) and the corresponding *Received Signal Strength Intensity* (RSSI). 
  + intensity values are represented as negative integer values ranging -104dBm (extremely poor signal) to 0dbM. 
  + 100 is used to denote when a WAP was not detected.
  + 520 different WAPs were detected. Thus, each WiFi fingerprint is composed by 520 intensity values.
- the coordinates (latitude, longitude, floor) and Building ID are the attributes to be predicted.
- type of space (e.g. office, lab) and relative position to the space (inside/outside) are included. Note: "outside" means that the capture was taken in front of the door to the space.
- Information about the users, as well as how (android device & version) and when (timestamp) WiFi capture was taken is also included.





## Load Pkgs & Data

```{r}
library(tidyverse)
library(here)
library(skimr)
library(broom)
library(janitor)
library(caret)

library(devtools)
 # installed pkg ggbiplot w/ install_github("vqv/ggbiplot") but when i loaded it there were conflicts with dplyr, so i unloaded it w/ detach("package:ggbiplot", unload=TRUE)
```


```{r}
#read in dataset
wifi <- read.csv(here("data", "trainingData.csv"))

#convert to tibble
as_tibble(wifi)
```






# DATA WRANGLING ##########################################

```{r}
# standardize var names  
wifi <- wifi %>%
  clean_names()

# remove unnecessary vars
wifi01 <- wifi %>% 
  select(-userid, -phoneid, -timestamp, -longitude, -latitude)

# return names of last 10 vars  
wifi01 %>%
  names() %>% 
  tail(10)
```




## Reduce WAP Variables #####################

There are 520 wifi access point (WAP) variables in the dataset. Using that many variables during modeling will be very computationally taxing and thus time consuming. 




### Zero & Near Zero Variance ######################

```{r}
# find and remove columns with zero variance
wifi02 <- wifi01 %>% 
  select(-(which(apply(wifi01, 2, var) == 0)))
```
That removed 55 WAP variables that had zero variance. Variables without variance are useless for modeling and cause problems for PCA analysis.

```{r}
# look for features with near zero variance
wifi02 %>% 
  select(wap001:wap519) %>% 
  nearZeroVar(freqCut = 95/5,
              uniqueCut = 95,
              saveMetrics = TRUE,
              foreach = TRUE,
              allowParallel = TRUE) %>% 
  arrange(desc(percentUnique))
```

There are 351 WAP variables with variance equal to or greater than 5%.

```{r}

```

```{r}
wifi02 %>% 
  select_if(nearZeroVar(percentUnique), any(percentUnique >= 0.05))
```




### Principle Component Analysis (PCA) ##################

Let's try to reduce the number of variables by selecting only the most important ones using principle component analysis (PCA). Which identifies the variables that have the most variance/ 

```{r}
# produce the PCA
pca_fit <- wifi02 %>% 
  prcomp(center = TRUE, scale = TRUE)


# plot the data in PC coordinates
pca_fit %>%
  augment(wifi02) %>% # add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2, color = buildingid)) + 
  geom_point(size = 1.5)
 ```


#### Extract PCA Components ##################

*Rotation Matrix*
```{r}
# extract rotation matrix
pca_fit %>%
  tidy(matrix = "rotation")
```


*Explained Variance*
```{r}
# create tibble of variance explained by each component
pca_fit %>%
  tidy(matrix = "eigenvalues")
```
PCA reveals that 321 components capture about 95% of the variance, and 258 components capture about 90% of the variance. 



### Summary ###############################


## Wifi Fingerprint
- vector of WAP1:WAP520
- need to do dimensionality reduction: filter to single building or reasonable sampling



## Create Unique Identifier for Each Location

Think about how best to combine the building, floor, and specific location attributes into a single unique identifier for each instance. Also think about the appropriate type for this "composite" attribute: Should it be numeric, a factor, or something else? Convert the composite location attribute if appropriate.


# MODELING ###########################################################


# MODEL EVALUATION ####################################################
